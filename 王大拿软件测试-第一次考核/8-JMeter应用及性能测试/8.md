### 8-1 JMeter工具基本熟悉

**课程介绍**

大家好，今天我们开始学习JMeter工具的基本使用。JMeter是一款流行的开源性能测试工具，主要用于负载测试和功能测试。我们将从JMeter的安装和配置开始，逐步深入了解其各项功能。

**安装与配置**

1. **下载JMeter**：
   - 访问[JMeter官方网站](https://jmeter.apache.org/)下载最新版本的JMeter。
   - 选择适合你操作系统的版本（Windows 32位或64位）。

2. **解压与安装**：
   - 将下载的压缩包解压到你指定的目录，例如`C:\JMeter`。
   - 配置环境变量，将JMeter的`bin`目录添加到系统的`PATH`中。

3. **验证安装**：
   - 打开命令提示符（CMD），输入`jmeter`命令，如果安装成功，JMeter的GUI界面将会启动。

**JMeter界面介绍**

- **测试计划（Test Plan）**：JMeter测试的顶层元素，所有测试组件都包含在测试计划中。
- **线程组（Thread Group）**：代表一组用户，用于模拟用户并发访问被测系统。
- **取样器（Samplers）**：用于发送各种类型的请求，如HTTP请求、FTP请求等。
- **监听器（Listeners）**：用于收集和展示测试结果，如查看结果树、聚合报告等。
- **逻辑控制器（Logic Controllers）**：用于控制测试计划的执行流程，如循环控制器、条件控制器等。
- **定时器（Timers）**：用于模拟用户请求之间的延迟。
- **断言（Assertions）**：用于验证返回结果是否符合预期。
- **配置元件（Config Elements）**：用于配置测试计划中的各种参数，如HTTP请求默认值、CSV数据文件设置等。

**创建简单的测试计划**

1. **启动JMeter**：
   - 在命令提示符中输入`jmeter`命令，启动JMeter。

2. **创建测试计划**：
   - 在JMeter的GUI界面中，右键点击“测试计划”，选择“添加”->“线程组”。

3. **配置线程组**：
   - 设置线程数（用户数）、循环次数、启动时间等参数。

4. **添加HTTP请求**：
   - 右键点击线程组，选择“添加”->“取样器”->“HTTP请求”。
   - 配置HTTP请求的协议、服务器名称或IP、端口号、请求方法（GET/POST）、路径等。

5. **添加监听器**：
   - 右键点击线程组，选择“添加”->“监听器”->“查看结果树”。
   - 用于查看每个请求的详细结果。

6. **运行测试**：
   - 点击工具栏上的绿色启动按钮，运行测试计划。
   - 查看“查看结果树”中的结果，确认请求是否成功。

### 8-2 JMeter接口请求

**课程介绍**

在上一节课中，我们学习了JMeter的基本使用。今天，我们将深入学习如何使用JMeter进行接口测试，包括GET和POST请求的发送，以及如何处理接口返回的数据。

**GET请求**

1. **创建GET请求**：
   - 在JMeter中创建一个新的线程组。
   - 右键点击线程组，选择“添加”->“取样器”->“HTTP请求”。
   - 配置HTTP请求的协议、服务器名称或IP、端口号、请求方法为GET，并填写请求路径。

2. **添加参数**：
   - 在HTTP请求下方，添加“HTTP请求默认值”或直接在HTTP请求中添加参数。
   - 参数以键值对的形式添加，例如`key=value`。

3. **运行测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看请求是否成功，并检查返回的数据。

**POST请求**

1. **创建POST请求**：
   - 类似于GET请求，创建一个新的HTTP请求，但将请求方法改为POST。
   - 在“消息体数据”标签页中，填写要发送的JSON或其他格式的数据。

2. **添加请求头**：
   - 右键点击HTTP请求，选择“添加”->“配置元件”->“HTTP信息头管理器”。
   - 添加必要的请求头，如`Content-Type: application/json`。

3. **运行测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看请求是否成功，并检查返回的数据。

**处理接口返回的数据**

1. **使用JSON提取器**：
   - 右键点击HTTP请求，选择“添加”->“后置处理器”->“JSON提取器”。
   - 配置JSON提取器，提取返回数据中的特定字段。

2. **使用正则表达式提取器**：
   - 如果返回的数据不是JSON格式，可以使用正则表达式提取器来提取数据。
   - 右键点击HTTP请求，选择“添加”->“后置处理器”->“正则表达式提取器”。

3. **使用提取的数据**：
   - 提取的数据可以存储在变量中，供后续的请求使用。
   - 在后续的HTTP请求中，使用`${variable_name}`来引用提取的数据。

### 8-3 JMeter并发及报告

**课程介绍**

在今天的课程中，我们将学习如何使用JMeter进行并发测试，并生成测试报告。并发测试是性能测试的重要组成部分，用于模拟多个用户同时访问系统，以评估系统的性能和稳定性。

**并发测试**

1. **配置线程组**：
   - 打开之前创建的测试计划。
   - 配置线程组的线程数（并发用户数）、循环次数、启动时间等参数。

2. **添加定时器**：
   - 为了更真实地模拟用户行为，可以在请求之间添加定时器。
   - 右键点击HTTP请求，选择“添加”->“定时器”->“固定定时器”或“随机定时器”。

3. **运行并发测试**：
   - 添加“聚合报告”监听器，用于收集性能数据。
   - 点击启动按钮，运行并发测试。

**生成测试报告**

1. **聚合报告**：
   - 聚合报告显示了每个请求的平均响应时间、中位数响应时间、90%线响应时间、最小响应时间、最大响应时间、错误率、吞吐量等关键性能指标。
   - 通过分析聚合报告，可以了解系统的性能瓶颈。

2. **查看结果树**：
   - 查看结果树提供了每个请求的详细信息，包括请求和响应的数据、请求时间、状态码等。
   - 用于调试和详细分析测试过程中的问题。

3. **生成HTML报告**：
   - JMeter支持生成HTML格式的测试报告，便于分享和展示。
   - 使用命令行模式运行JMeter，并添加`-l <log_file>`和`-e -o <output_folder>`参数来生成HTML报告。
   - 例如：
     ```
     jmeter -n -t <test_plan.jmx> -l <log_file> -e -o <output_folder>
     ```

### 8-4 JMeter提取器及控制器

**课程介绍**

在今天的课程中，我们将学习JMeter中的提取器和控制器。提取器用于从响应数据中提取特定信息，控制器用于控制测试计划的执行流程。

**提取器**

1. **JSON提取器**：
   - 用于从JSON格式的响应数据中提取特定字段。
   - 右键点击HTTP请求，选择“添加”->“后置处理器”->“JSON提取器”。
   - 配置JSON提取器，指定要提取的字段和变量名。

2. **正则表达式提取器**：
   - 用于从非JSON格式的响应数据中提取信息。
   - 右键点击HTTP请求，选择“添加”->“后置处理器”->“正则表达式提取器”。
   - 配置正则表达式，指定匹配规则和变量名。

3. **使用提取的数据**：
   - 提取的数据可以存储在变量中，供后续的请求使用。
   - 在后续的HTTP请求中，使用`${variable_name}`来引用提取的数据。

**控制器**

1. **循环控制器**：
   - 用于多次执行控制器内的请求。
   - 右键点击线程组，选择“添加”->“逻辑控制器”->“循环控制器”。
   - 配置循环次数。

2. **条件控制器**：
   - 用于根据条件执行控制器内的请求。
   - 右键点击线程组，选择“添加”->“逻辑控制器”->“如果（If）控制器”。
   - 配置条件表达式。

3. **随机控制器**：
   - 用于随机执行控制器内的请求。
   - 右键点击线程组，选择“添加”->“逻辑控制器”->“随机控制器”。

4. **仅一次控制器**：
   - 用于在测试计划执行期间仅执行一次控制器内的请求。
   - 右键点击线程组，选择“添加”->“逻辑控制器”->“仅一次控制器”。

**示例：使用JSON提取器和循环控制器**

1. **创建测试计划**：
   - 创建一个新的测试计划，并添加一个线程组。

2. **添加HTTP请求**：
   - 在线程组中添加一个HTTP请求，用于获取JSON格式的数据。

3. **添加JSON提取器**：
   - 右键点击HTTP请求，选择“添加”->“后置处理器”->“JSON提取器”。
   - 配置JSON提取器，提取需要的数据，并存储在变量中。

4. **添加循环控制器**：
   - 右键点击线程组，选择“添加”->“逻辑控制器”->“循环控制器”。
   - 配置循环次数。

5. **在循环控制器中添加HTTP请求**：
   - 在循环控制器中添加一个新的HTTP请求，用于使用提取的数据。
   - 在HTTP请求中使用`${variable_name}`引用提取的数据。

6. **运行测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看提取的数据是否正确，并检查循环控制器是否按预期工作。

### 8-5 JMeter文件上传及WebSocket

**课程介绍**

在今天的课程中，我们将学习如何在JMeter中进行文件上传测试，以及如何使用JMeter进行WebSocket测试。文件上传测试用于测试系统处理文件上传的功能，WebSocket测试用于测试实时通信功能。

**文件上传测试**

1. **创建测试计划**：
   - 创建一个新的测试计划，并添加一个线程组。

2. **添加HTTP请求**：
   - 在线程组中添加一个HTTP请求，用于文件上传。
   - 配置HTTP请求的协议、服务器名称或IP、端口号、请求方法为POST。

3. **配置文件上传参数**：
   - 在HTTP请求的“文件上传”标签页中，添加要上传的文件。
   - 配置文件的参数名和MIME类型。

4. **添加HTTP信息头管理器**：
   - 右键点击HTTP请求，选择“添加”->“配置元件”->“HTTP信息头管理器”。
   - 添加必要的请求头，如`Content-Type: multipart/form-data`。

5. **运行测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看文件是否成功上传，并检查返回的数据。

**WebSocket测试**

1. **安装WebSocket插件**：
   - 下载WebSocket插件（如WebSocket Sampler），并将其放置在JMeter的`lib/ext`目录下。
   - 重启JMeter。

2. **创建测试计划**：
   - 创建一个新的测试计划，并添加一个线程组。

3. **添加WebSocket Sampler**：
   - 在线程组中添加一个WebSocket Sampler。
   - 配置WebSocket Sampler的服务器名称或IP、端口号、路径等。

4. **配置WebSocket连接**：
   - 在WebSocket Sampler中配置连接参数，如协议（ws或wss）、超时时间等。

5. **添加WebSocket请求和响应**：
   - 在WebSocket Sampler中添加要发送的消息和期望的响应。

6. **运行测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看WebSocket连接是否成功建立，并检查消息是否正确发送和接收。

**示例：文件上传测试**

1. **创建测试计划**：
   - 创建一个新的测试计划，并添加一个线程组。
2. **添加HTTP请求**：
   - 在线程组中添加一个HTTP请求，用于文件上传。
   - 配置HTTP请求的协议、服务器名称或IP、端口号、请求方法为POST。
3. **配置文件上传参数**：
   - 在HTTP请求的“文件上传”标签页中，添加要上传的文件。
   - 配置文件的参数名（如`file`）和MIME类型（如`image/png`）。
4. **添加HTTP信息头管理器**：
   - 右键点击HTTP请求，选择“添加”->“配置元件”->“HTTP信息头管理器”。

**WebSocket测试示例**

1. **配置WebSocket连接**：
   - 在WebSocket Sampler中，配置WebSocket的连接URL，例如`ws://echo.websocket.org`（这是一个公共的WebSocket测试服务）。
   - 设置连接超时时间，例如5000毫秒。

2. **添加WebSocket请求**：
   - 在WebSocket Sampler的“请求”标签页中，添加要发送的消息，例如`Hello, WebSocket!`。
   - 如果需要发送多条消息，可以添加多个请求步骤。

3. **添加WebSocket响应断言**：
   - 右键点击WebSocket Sampler，选择“添加”->“断言”->“响应断言”。
   - 配置断言，检查响应数据是否包含预期的消息，例如`Hello, WebSocket!`。

4. **运行WebSocket测试**：
   - 添加“查看结果树”监听器。
   - 运行测试，查看WebSocket连接是否成功建立，消息是否正确发送和接收。
   - 检查断言结果，确认响应数据是否符合预期。

### 8-6 JMeter高级功能与最佳实践

**课程介绍**

在今天的课程中，我们将探讨JMeter的高级功能和最佳实践，帮助你更高效地进行性能测试和接口测试。我们将涵盖分布式测试、命令行模式、参数化测试、关联与数据驱动测试等内容。

**分布式测试**

1. **为什么要进行分布式测试**：
   - 当需要模拟大量用户并发访问时，单机JMeter可能无法满足性能需求。
   - 分布式测试可以利用多台机器的资源，模拟更高的并发用户数。

2. **配置分布式测试**：
   - **主节点（Master）**：负责控制测试计划的执行和收集测试结果。
   - **从节点（Slave）**：负责执行测试计划中的请求。
   - 在每台从节点上启动JMeter服务器：
     ```
     jmeter-server
     ```
   - 在主节点上配置`jmeter.properties`文件，指定从节点的IP地址和端口：
     ```
     remote_hosts=192.168.1.100:1099,192.168.1.101:1099
     ```
   - 使用命令行模式启动分布式测试：
     ```
     jmeter -n -t <test_plan.jmx> -R <remote_hosts>
     ```

**命令行模式**

1. **为什么要使用命令行模式**：
   - 命令行模式（Non-GUI模式）可以减少JMeter的资源占用，提高测试效率。
   - 适用于长时间运行的测试和大规模并发测试。

2. **常用命令行参数**：
   - `-n`：非GUI模式。
   - `-t <test_plan.jmx>`：指定测试计划文件。
   - `-l <log_file>`：指定测试结果日志文件。
   - `-R <remote_hosts>`：指定远程节点（用于分布式测试）。
   - `-e -o <output_folder>`：生成HTML格式的测试报告。

3. **示例**：
   - 运行测试计划并生成HTML报告：
     ```
     jmeter -n -t <test_plan.jmx> -l <log_file> -e -o <output_folder>
     ```

**参数化测试**

1. **为什么要进行参数化测试**：
   - 参数化测试可以使测试用例更加灵活，能够覆盖更多的测试场景。
   - 避免硬编码数据，提高测试脚本的可维护性。

2. **参数化测试方法**：
   - **CSV Data Set Config**：从CSV文件中读取测试数据。
     - 添加“CSV Data Set Config”元件，配置文件路径、变量名等。
     - 在HTTP请求中使用`${variable_name}`引用变量。
   - **用户定义的变量**：在测试计划中定义变量，供测试用例使用。
     - 右键点击测试计划，选择“添加”->“配置元件”->“用户定义的变量”。
     - 添加变量名和值。
   - **函数助手**：使用JMeter内置的函数生成测试数据。
     - 右键点击测试计划，选择“帮助”->“函数助手对话框”。
     - 选择函数（如`__Random`、`__UUID`等），生成函数表达式。

3. **示例：使用CSV Data Set Config**：
   - 创建一个CSV文件（如`data.csv`），包含测试数据：
     ```
     username,password
     user1,pass1
     user2,pass2
     ```
   - 在测试计划中添加“CSV Data Set Config”，配置文件路径和变量名。
   - 在HTTP请求中使用`${username}`和`${password}`引用变量。

**关联与数据驱动测试**

1. **关联（Correlation）**：
   - 关联用于从响应数据中提取动态值（如Session ID、Token等），并在后续请求中使用。
   - 使用“正则表达式提取器”或“JSON提取器”提取动态值。
   - 在后续请求中使用提取的变量。

2. **数据驱动测试**：
   - 数据驱动测试通过外部数据源（如CSV文件、数据库等）驱动测试用例的执行。
   - 使用“CSV Data Set Config”或“JDBC Connection Configuration”读取外部数据。
   - 在测试用例中使用变量引用外部数据。

3. **示例：关联与数据驱动测试**：
   - 添加“HTTP请求”获取包含Token的响应。
   - 添加“JSON提取器”提取Token，并存储在变量中。
   - 添加“CSV Data Set Config”读取测试数据（如用户名和密码）。
   - 在后续的HTTP请求中使用提取的Token和CSV文件中的用户名、密码。

### 8-7 JMeter测试优化与调试技巧

**课程介绍**

在今天的课程中，我们将学习如何优化JMeter测试脚本的性能，以及如何调试测试过程中遇到的问题。我们将涵盖性能优化技巧、调试方法、日志分析等内容。

**性能优化技巧**

1. **减少监听器的使用**：
   - 监听器会消耗大量资源，尽量减少监听器的数量。
   - 在非调试模式下，只保留必要的监听器（如“聚合报告”）。

2. **使用非GUI模式**：
   - 使用命令行模式运行测试，减少资源占用。

3. **合理配置线程组**：
   - 根据测试需求合理设置线程数、循环次数和启动时间。
   - 避免设置过高的线程数，导致资源耗尽。

4. **优化HTTP请求**：
   - 使用“HTTP请求默认值”配置公共参数，减少重复配置。
   - 启用“并行下载”选项，提高资源加载速度。

5. **使用分布式测试**：
   - 利用多台机器的资源，模拟更高的并发用户数。

**调试技巧**

1. **使用“查看结果树”**：
   - 在调试过程中，使用“查看结果树”监听器查看每个请求的详细信息。
   - 检查请求和响应数据，定位问题。

2. **添加断言**：
   - 使用“响应断言”验证响应数据是否符合预期。
   - 使用“JSON断言”或“XPath断言”验证JSON或XML格式的响应数据。

3. **日志分析**：
   - 启用JMeter的日志功能，记录测试过程中的详细信息。
   - 分析日志文件，定位错误和性能瓶颈。

4. **使用调试取样器**：
   - 添加“调试取样器”生成调试信息，帮助定位问题。

**示例：调试HTTP请求**

1. **添加“查看结果树”**：
   - 在测试计划中添加“查看结果树”监听器。
   - 运行测试，查看每个请求的详细信息。

2. **添加“响应断言”**：
   - 在HTTP请求中添加“响应断言”，验证响应数据是否包含预期的字符串。
   - 运行测试，检查断言结果。

3. **分析日志**：
   - 在`jmeter.log`文件中查看详细的日志信息。
   - 根据日志信息定位问题，例如连接超时、认证失败等。

### 8-8 JMeter与持续集成/持续交付（CI/CD）集成

**课程介绍**

在今天的课程中，我们将学习如何将JMeter与CI/CD流程集成，实现自动化性能测试。我们将涵盖Jenkins集成、GitLab CI集成、自动化测试脚本管理等内容。

**Jenkins集成**

1. **安装Jenkins插件**：
   - 在Jenkins中安装“Performance Plugin”插件，用于解析JMeter测试结果。

2. **创建Jenkins任务**：
   - 创建一个新的Freestyle项目或Pipeline项目。
   - 配置源代码管理（如Git），指定测试脚本的仓库。

3. **配置构建步骤**：
   - 添加“Execute shell”或“Execute Windows batch command”步骤，运行JMeter测试：
     ```
     jmeter -n -t <test_plan.jmx> -l <log_file> -e -o <output_folder>
     ```

4. **配置后处理步骤**：
   - 使用“Performance Plugin”解析JMeter测试结果，生成性能趋势图。
   - 配置邮件通知或Slack通知，在测试失败时发送警报。

**GitLab CI集成**

1. **创建`.gitlab-ci.yml`文件**：
   - 在项目根目录下创建`.gitlab-ci.yml`文件，定义CI/CD流程。

2. **配置测试阶段**：
   - 在`.gitlab-ci.yml`中定义一个测试阶段，运行JMeter测试：
     ```yaml
     test:
       stage: test
       script:
         - jmeter -n -t <test_plan.jmx> -l <log_file> -e -o <output_folder>
       artifacts:
         paths:
           - <output_folder>
     ```

3. **配置缓存和依赖**：
   - 配置缓存和依赖，确保JMeter和测试脚本在CI/CD环境中可用。

**自动化测试脚本管理**

1. **版本控制**：
   - 使用Git等版本控制系统管理JMeter测试脚本。
   - 确保测试脚本与应用程序代码同步更新。

2. **自动化测试环境**：
   - 使用Docker或Kubernetes搭建自动化测试环境，确保环境一致性。
   - 在CI/CD流程中自动启动和关闭测试环境。

3. **测试数据管理**：
   - 使用外部数据源（如CSV文件、数据库）管理测试数据。
   - 在CI/CD流程中自动生成和清理测试数据。

**示例：Jenkins集成**

1. **安装Jenkins和Performance Plugin**：
   - 下载并安装Jenkins。
   - 在Jenkins中安装“Performance Plugin”插件。

2. **创建Jenkins任务**：
   - 创建一个新的Freestyle项目。
   - 配置源代码管理，指定测试脚本的Git仓库。

3. **配置构建步骤**：
   - 添加“Execute shell”步骤，运行JMeter测试：
     ```
     jmeter -n -t <test_plan.jmx> -l <log_file> -e -o <output_folder>
     ```

4. **配置后处理步骤**：
   - 在“Post-build Actions”中添加“Publish Performance test result report”。
   - 配置报告路径，生成性能趋势图。

5. **运行Jenkins任务**：
   - 触发Jenkins任务，运行JMeter测试。
   - 查看测试结果和性能趋势图。

### 总结

通过本课程的学习，你已经掌握了JMeter的基本使用、接口测试、并发测试、文件上传测试、WebSocket测试、高级功能与最佳实践、测试优化与调试技巧，以及与CI/CD流程的集成。这些知识和技能将帮助你更高效地进行性能测试和接口测试，确保系统的质量和稳定性。