### 6-1 Charles基本抓包设置

**课程介绍**

大家好，今天我们来学习Charles这款抓包工具。Charles是一个用于抓包和分析网络请求的工具，类似于Fiddler。我们今天主要讲解Charles的基本设置和使用方法。

**安装Charles**

1. **下载Charles**：
   - 访问Charles官网（[https://www.charlesproxy.com](https://www.charlesproxy.com)）。
   - 选择适合你操作系统的版本（Windows、macOS或Linux）进行下载。

2. **安装Charles**：
   - 下载完成后，运行安装程序，按照提示完成安装。

**Charles界面介绍**

1. **启动Charles**：
   - 安装完成后，启动Charles。
   - 初次启动会有30天的试用期。

2. **Charles功能概述**：
   - Charles主要用于抓包和分析前端与后端之间的接口请求。
   - 类似于高速公路的收费站，所有请求都会经过Charles进行处理。

**抓包设置**

1. **设置代理**：
   - 在Charles中，选择`Proxy` -> `macOS Proxy`（Windows用户选择对应的代理设置）。
   - 这样Charles会拦截你电脑上所有的网页请求。

2. **抓取HTTP请求**：
   - 打开浏览器，访问一个网站（如：[http://www.hao123.com](http://www.hao123.com)）。
   - 在Charles中可以看到抓取到的请求。

3. **抓取HTTPS请求**：
   - HTTPS请求是加密的，需要安装Charles的证书才能解密。
   - 选择`Help` -> `SSL Proxying` -> `Install Charles Root Certificate`。
   - 按照提示安装证书，并确保证书在有效期内。

4. **SSL代理设置**：
   - 选择`Proxy` -> `SSL Proxying Settings`。
   - 在`SSL Proxying`选项卡中，添加一个配置，主机名和端口都设为`*`，表示拦截所有HTTPS请求。

**过滤请求**

1. **结构与序列**：
   - `Structure`视图：按网站分类显示请求。
   - `Sequence`视图：按时间顺序显示所有请求。

2. **过滤请求**：
   - 在`Filter`输入框中输入关键词（如：`baidu.com`），可以过滤出相关的请求。

**小结**

- Charles是一个功能强大的抓包工具，主要用于分析和调试前后端接口。
- 通过设置代理和安装证书，可以抓取HTTP和HTTPS请求。
- 使用过滤功能可以方便地查看特定的请求。

### 6-2 抓包工具的基本操作-必备

**课程介绍**

大家好，今天我们继续学习Charles的基本操作，包括抓包、过滤、弱网测试和手机抓包。

**抓包与过滤**

1. **抓包**：
   - 启动Charles后，默认会抓取所有经过代理的请求。
   - 使用`Clear`按钮可以清空当前抓取的请求。

2. **过滤请求**：
   - 在`Filter`输入框中输入关键词，可以过滤出相关的请求。
   - 例如，输入`baidu.com`，只显示与百度相关的请求。

3. **高级过滤**：
   - 选择`Proxy` -> `Recording Settings`。
   - 在`Include`选项卡中，可以添加过滤规则，如只抓取特定协议、主机或端口的请求。

**弱网测试**

1. **弱网测试的目的**：
   - 模拟网络不好的情况，测试应用在不同网络环境下的表现。

2. **设置弱网**：
   - 选择`Proxy` -> `Throttle Settings`。
   - 启用`Throttle`，并选择特定的主机进行弱网模拟。
   - 可以设置带宽、延迟等参数，模拟2G、3G、4G等网络环境。

**手机抓包**

1. **手机与电脑在同一局域网**：
   - 确保手机和电脑连接到同一个WiFi网络。

2. **设置手机代理**：
   - 在手机的WiFi设置中，选择当前连接的WiFi，配置代理。
   - 代理服务器地址为电脑的IP地址，端口为8888（Charles默认端口）。

3. **安装Charles证书**：
   - 在手机浏览器中访问`chls.pro/ssl`，下载并安装Charles的证书。
   - 安装完成后，可以抓取手机上的HTTPS请求。

**小结**

- 使用Charles的过滤功能可以方便地查看特定的请求。
- 弱网测试可以模拟不同的网络环境，测试应用的稳定性。
- 通过设置手机代理和安装证书，可以抓取手机上的网络请求。

### 6-3 抓包断点及本远地映射

**课程介绍**

大家好，今天我们学习Charles的高级功能，包括断点、本地映射和远程映射。

**断点**

1. **断点的概念**：
   - 断点用于拦截和修改请求或响应的数据，常用于调试和测试。

2. **设置断点**：
   - 在Charles中，右键点击一个请求，选择`Breakpoints`。
   - 刷新页面，Charles会拦截该请求。

3. **修改请求和响应**：
   - 在`Edit Request`选项卡中，可以修改请求的数据。
   - 在`Edit Response`选项卡中，可以修改响应的数据。
   - 修改完成后，点击`Execute`继续执行请求。

**本地映射**

1. **本地映射的概念**：
   - 本地映射用于将某个请求的响应替换为本地文件的内容，常用于模拟后端接口的返回数据。

2. **设置本地映射**：
   - 右键点击一个请求，选择`Map Local`。
   - 选择本地文件，保存配置。
   - 刷新页面，Charles会使用本地文件的内容作为响应。

**远程映射**

1. **远程映射的概念**：
   - 远程映射用于将某个请求的响应替换为另一个URL的响应，常用于测试不同环境下的接口。

2. **设置远程映射**：
   - 右键点击一个请求，选择`Map Remote`。
   - 输入目标URL，保存配置。
   - 刷新页面，Charles会使用目标URL的响应。

**实际案例**

1. **断点案例**：
   - 假设我们需要测试一个登录接口，在密码错误时是否显示正确的错误信息。
   - 设置断点拦截登录请求，修改请求中的密码为错误值。
   - 修改响应中的错误信息，确保前端正确显示。

2. **本地映射案例**：
   - 假设后端接口尚未开发完成，但前端需要测试数据展示。
   - 创建一个本地JSON文件，包含测试数据。
   - 设置本地映射，将请求的响应替换为本地文件的内容。

3. **远程映射案例**：
   - 假设我们需要测试生产环境和测试环境的接口差异。
   - 设置远程映射，将测试环境的请求映射到生产环境的URL。
   - 刷新页面，Charles会使用生产环境的响应。

**小结**

- 断点功能可以拦截和修改请求或响应的数据，常用于调试和测试。
- 本地映射可以将请求的响应替换为本地文件的内容，模拟后端接口的返回数据。
- 远程映射可以将请求的响应替换为另一个URL的响应，测试不同环境下的接口。
